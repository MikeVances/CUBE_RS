# üîç –ê–ù–ê–õ–ò–ó –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–ò–í–ù–û–ì–û –§–£–ù–ö–¶–ò–û–ù–ê–õ–ê CUBE_RS

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 3 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –ì–û–¢–û–í

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï –ü–û –í–û–ü–†–û–°–£

> **–í–æ–ø—Ä–æ—Å:** "–ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å, –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä–∞–∑–¥–∞–≤–∞—Ç—å –∏–º –∫–ª—é—á–∏ –∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –∫ –∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º?"

### ‚ùå **–ü–†–û–ë–õ–ï–ú–´ - –ß–¢–û –ù–ï –ì–û–¢–û–í–û:**

#### 1. **–ù–ï–¢ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–ò–í–ù–û–ì–û –ò–ù–¢–ï–†–§–ï–ô–°–ê**
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∞–¥–º–∏–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- ‚ùå –ù–µ—Ç —Ñ–æ—Ä–º –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå –ù–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–ª—è–º–∏
- ‚ùå –ù–µ—Ç –ø–∞–Ω–µ–ª–∏ –æ–¥–æ–±—Ä–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤

#### 2. **–ù–ï–¢ API –ú–ê–†–®–†–£–¢–û–í –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø**
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç `/api/admin/users` –º–∞—Ä—à—Ä—É—Ç—ã
- ‚ùå –ù–µ—Ç `/api/admin/roles` –º–∞—Ä—à—Ä—É—Ç–æ–≤  
- ‚ùå –ù–µ—Ç `/api/admin/devices` –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚ùå –ù–µ—Ç `/api/admin/auth-keys` –º–∞—Ä—à—Ä—É—Ç–æ–≤

#### 3. **–ù–ï–¢ –°–ò–°–¢–ï–ú–´ –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò**
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç login/logout —Å–∏—Å—Ç–µ–º–∞
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚ùå –ù–µ—Ç —Å–µ—Å—Å–∏–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## ‚úÖ **–ß–¢–û –£–ñ–ï –ï–°–¢–¨ –ò –†–ê–ë–û–¢–ê–ï–¢:**

### üèóÔ∏è **BACKEND –ì–û–¢–û–í –ù–ê 90%**

#### 1. **RBAC –°–∏—Å—Ç–µ–º–∞ (web_app/rbac_system.py)**
```python
# ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- create_user()           # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- create_role()           # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏
- create_device_group()   # –ì—Ä—É–ø–ø—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- create_access_policy()  # –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- check_user_permission() # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
```

#### 2. **Device Registry (web_app/device_registry.py)**  
```python
# ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- generate_auth_key()                  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
- create_registration_request()        # –ó–∞–ø—Ä–æ—Å—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- approve_registration_request()       # –û–¥–æ–±—Ä–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- get_pending_registration_requests()  # –û–∂–∏–¥–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- get_registered_devices()             # –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
```

#### 3. **–†–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚úÖ
- **Farm Administrator** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–µ—Ä–º–µ
- **Farm Operator** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±–∞–∑–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ  
- **Service Engineer** - –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- **Read Only** - —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä
- **System Administrator** - –ø–æ–ª–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø

---

## üöß **–ü–†–û–¶–ï–°–° –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –£–°–¢–†–û–ô–°–¢–í–ê (–¢–ï–û–†–ï–¢–ò–ß–ï–°–ö–ò–ô):**

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```python
registry = get_device_registry()
auth_key = registry.generate_auth_key(
    expires_hours=24,
    is_reusable=True,
    tags=["farm"],
    created_by="admin"
)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: tskey-xxxxxxxxxxxx
```

### –®–∞–≥ 2: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```python
request_id = registry.create_registration_request(
    auth_key="tskey-xxxxxxxxxxxx",
    device_hostname="farm-001",
    device_type="farm",
    device_info={
        "os": "Linux",
        "location": "–¢–µ–ø–ª–∏—Ü–∞ #1",
        "capabilities": ["kub1063"]
    }
)
```

### –®–∞–≥ 3: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä—è–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
```python
success = registry.approve_registration_request(
    request_id=request_id,
    approved_by="admin"
)
# –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø
```

---

## üéØ **–ß–¢–û –ù–£–ñ–ù–û –î–û–î–ï–õ–ê–¢–¨ –î–õ–Ø –ü–û–õ–ù–û–ô –ì–û–¢–û–í–ù–û–°–¢–ò:**

### üî¥ **–ö–†–ò–¢–ò–ß–ù–û (1-2 –¥–Ω—è —Ä–∞–±–æ—Ç—ã):**

#### 1. –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```html
<!-- –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã: -->
/admin                    # –ì–ª–∞–≤–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
/admin/users             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏  
/admin/devices           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
/admin/auth-keys         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏
/admin/registrations     # –û–¥–æ–±—Ä–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
```

#### 2. –î–æ–±–∞–≤–∏—Ç—å API –º–∞—Ä—à—Ä—É—Ç—ã –≤ web_app/app.py
```python
@app.route('/api/admin/users', methods=['GET', 'POST'])
@require_permission(Permission.USER_MANAGE.value)
def manage_users():
    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

@app.route('/api/admin/auth-keys', methods=['POST'])  
@require_permission(Permission.DEVICE_REGISTER.value)
def create_auth_key():
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π

@app.route('/api/admin/registrations', methods=['GET'])
@require_permission(Permission.DEVICE_REGISTER.value) 
def pending_registrations():
    # –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
```

#### 3. –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```python
@app.route('/login', methods=['GET', 'POST'])
def login():
    # –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

@app.route('/logout')
def logout():
    # –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
```

---

## üöÄ **–ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï - –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –ì–û–¢–û–í–´–ï –ü–†–ò–ú–ï–†–´:**

–í —Å–∏—Å—Ç–µ–º–µ —É–∂–µ –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–µ –ø—Ä–∏–º–µ—Ä—ã –≤ —Ñ–∞–π–ª–∞—Ö:
- `web_app/rbac_system.py` (—Å—Ç—Ä–æ–∫–∏ 701-760) - —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `web_app/device_registry.py` (—Å—Ç—Ä–æ–∫–∏ 595-649) - —Ç–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### üîß **–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å CLI —É—Ç–∏–ª–∏—Ç—É –∑–∞ 30 –º–∏–Ω—É—Ç:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
python tools/create_admin_user.py --username admin --password secret123

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞  
python tools/generate_device_key.py --type farm --expires 24h

# –û–¥–æ–±—Ä–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
python tools/approve_registrations.py --request-id xyz123
```

---

## üìä **–ì–û–¢–û–í–ù–û–°–¢–¨ –°–ò–°–¢–ï–ú–´:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å |
|-----------|---------|------------|
| üîê RBAC —Å–∏—Å—Ç–µ–º–∞ | ‚úÖ –ì–æ—Ç–æ–≤–æ | 100% |
| üì± Device Registry | ‚úÖ –ì–æ—Ç–æ–≤–æ | 100% |
| üîë –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π | ‚úÖ –ì–æ—Ç–æ–≤–æ | 100% |
| üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | ‚úÖ Backend –≥–æ—Ç–æ–≤ | 90% |
| üåê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π UI | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | 0% |
| üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | 0% |
| üìã API –º–∞—Ä—à—Ä—É—Ç—ã | ‚ùå –ß–∞—Å—Ç–∏—á–Ω–æ | 20% |

### **–û–ë–©–ê–Ø –ì–û–¢–û–í–ù–û–°–¢–¨: 60%** 

---

## üéØ **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:**

### –í–∞—Ä–∏–∞–Ω—Ç 1: CLI —É—Ç–∏–ª–∏—Ç—ã (–±—ã—Å—Ç—Ä–æ)
–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ - –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞ –¥–µ–Ω—å

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–ø—Ä–∞–≤–∏–ª—å–Ω–æ) 
–î–æ–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ - –Ω—É–∂–Ω–æ 2-3 –¥–Ω—è

### –í–∞—Ä–∏–∞–Ω—Ç 3: Telegram —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ)
–†–∞—Å—à–∏—Ä–∏—Ç—å Telegram –±–æ—Ç–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

---

## üö® **–ì–õ–ê–í–ù–´–ô –í–´–í–û–î:**

**–°–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–º–µ–µ—Ç –ü–û–õ–ù–£–Æ –ª–æ–≥–∏–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, –Ω–æ –ù–ï–¢ —É–¥–æ–±–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.**

**Backend –≥–æ—Ç–æ–≤ –Ω–∞ 90%, Frontend –∞–¥–º–∏–Ω–∫–∏ –Ω–∞ 0%.**

**–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.**