# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã CUBE_RS

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
python tools/start_all_services.py
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
python tools/stop_all_services.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
python tools/check_services_status.py
```

### –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
python tools/kill_all.py
```

## üìã –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Å–∏—Å—Ç–µ–º—ã

| –°–µ—Ä–≤–∏—Å                     | –ü–æ—Ä—Ç/URL                    | –û–ø–∏—Å–∞–Ω–∏–µ                           | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö |
|----------------------------|-----------------------------|------------------------------------|-----------------|
| **Web Dashboard (Flask)**  | http://localhost:5000       | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å          | API Gateway     |
| **Modbus Gateway**         | http://localhost:8000       | API –¥–ª—è —á—Ç–µ–Ω–∏—è –ö–£–ë-1063            | Modbus TCP/RTU  |
| **Tailscale Manager**      | -                           | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ mesh-—Å–µ—Ç—å—é              | Tailscale API   |
| **Device Registry**        | -                           | –°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤      | SQLite          |
| **RBAC System**            | -                           | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ä–æ–ª—è–º–∏ | SQLite          |
| **WebSocket Server**       | ws://localhost:8765         | Real-time –¥–∞–Ω–Ω—ã–µ                   | SQLite          |
| **Telegram Bot**           | -                           | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∫–æ–º–∞–Ω–¥—ã              | SQLite          |

### Legacy —Å–µ—Ä–≤–∏—Å—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏):
| –°–µ—Ä–≤–∏—Å                | –ü–æ—Ä—Ç/URL              | –û–ø–∏—Å–∞–Ω–∏–µ                |
|-----------------------|----------------------|-------------------------|
| **TCP Duplicator**    | 5022                 | JSON over TCP           |
| **MQTT Publisher**    | -                    | MQTT –ø—É–±–ª–∏–∫–∞—Ü–∏—è         |
| **Streamlit Dashboard**| http://localhost:8501| –°—Ç–∞—Ä—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å   |

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
RS485 (/dev/tty.usbserial-2110)
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Time Window Manager   ‚îÇ ‚Üê –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –¥–æ—Å—Ç—É–ø–∞ (5—Å –æ–∫–Ω–æ, 10—Å cooldown)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Gateway       ‚îÇ    ‚îÇ TCP Duplicator‚îÇ
‚îÇ (Modbus TCP)  ‚îÇ    ‚îÇ (JSON over TCP)‚îÇ
‚îÇ Port: 5021    ‚îÇ    ‚îÇ Port: 5022    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SQLite DB     ‚îÇ    ‚îÇ Remote Clients‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Dashboard     ‚îÇ ‚îÇ WebSocket     ‚îÇ ‚îÇ Telegram Bot  ‚îÇ
‚îÇ (Streamlit)   ‚îÇ ‚îÇ Server        ‚îÇ ‚îÇ               ‚îÇ
‚îÇ Port: 8501    ‚îÇ ‚îÇ Port: 8765    ‚îÇ ‚îÇ               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì                ‚Üì                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Web Browser   ‚îÇ ‚îÇ Web Clients   ‚îÇ ‚îÇ Telegram Users‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### Gateway (Modbus TCP)
```bash
python modbus/gateway.py
pkill -f gateway.py
```

### TCP Duplicator
```bash
python modbus/tcp_duplicator.py
pkill -f tcp_duplicator.py
```

### Dashboard (Streamlit)
```bash
streamlit run dashboard/app.py --server.port 8501
pkill -f streamlit
```

### WebSocket Server
```bash
python publish/websocket_server.py
pkill -f websocket_server.py
```

### Telegram Bot
```bash
python publish/telegram_bot.py
pkill -f telegram_bot.py
```

### MQTT Publisher
```bash
python publish/mqtt.py
pkill -f mqtt.py
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
python tools/check_services_status.py
ps aux | grep -E "(gateway|dashboard|websocket|telegram|mqtt|tcp_duplicator)"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
```bash
lsof -i :5021  # Gateway
lsof -i :5022  # TCP Duplicator
lsof -i :8501  # Dashboard
lsof -i :8765  # WebSocket
```

### –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞
```bash
python modbus/gateway.py 2>&1 | tee gateway.log
python modbus/tcp_duplicator.py 2>&1 | tee duplicator.log
```

## üõ°Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install -r requirements.txt`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã: `lsof -i :<PORT>`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ RS485: `ls -la /dev/tty.usbserial-2110`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `python tools/check_services_status.py` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ `tools/stop_all_services.py` –∏ `tools/start_all_services.py`

## üìÑ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Python
find . -name "*.pyc" -delete
find . -name "__pycache__" -type d -exec rm -rf {} +

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep python

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch -n 1 'python tools/check_services_status.py'

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
tail -f *.log
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞:** Gateway ‚Üí TCP Duplicator ‚Üí –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–õ–æ–≥–∏:** –≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º
4. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:** —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ firewall –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–æ—Ä—Ç–æ–≤ 