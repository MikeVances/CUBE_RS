# üéâ TUNNEL SYSTEM - –ì–æ—Ç–æ–≤—ã–π deployment –ø–∞–∫–µ—Ç

## ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–°–æ–∑–¥–∞–Ω **production-ready –ø–∞–∫–µ—Ç** –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Tunnel System –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π, –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ watchdog.

## üì¶ **–ß—Ç–æ –≤ –ø–∞–∫–µ—Ç–µ**

### üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã:**
```
üì± Mobile App ‚Üê‚îÄ‚îÄ‚îÄ WebRTC P2P ‚îÄ‚îÄ‚îÄ‚Üí üè≠ Farm Gateway
        ‚Üì                              ‚Üì
    üìû Request contacts           üìû Register every 5min  
        ‚Üì                              ‚Üì
        üåê Tunnel Broker Server (–±–µ–ª—ã–π IP)
              ‚îú‚îÄ üîß Watchdog (–∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
              ‚îú‚îÄ üíæ SQLite Database
              ‚îú‚îÄ üîå WebSocket Server  
              ‚îú‚îÄ üåç REST API
              ‚îî‚îÄ üõ°Ô∏è Nginx Proxy
```

### üìÅ **–ì–æ—Ç–æ–≤—ã–π –∞—Ä—Ö–∏–≤:** `/tmp/tunnel-system-20250901-110343.tar.gz` (32KB)

### üéØ **–í–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ **Tunnel Broker** —Å –ø–æ–ª–Ω—ã–º API
- ‚úÖ **Farm Client** –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ñ–µ—Ä–º
- ‚úÖ **Mobile App** —Å –∫—Ä–∞—Å–∏–≤—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
- ‚úÖ **Watchdog** —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏ —Å–±–æ—è—Ö
- ‚úÖ **Systemd —Å–µ—Ä–≤–∏—Å** —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º
- ‚úÖ **Nginx reverse proxy** 
- ‚úÖ **–ê–≤—Ç–æ—É—Å—Ç–∞–Ω–æ–≤—â–∏–∫** `deploy.sh`
- ‚úÖ **–°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** `tunnel-system`
- ‚úÖ **Firewall –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**
- ‚úÖ **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

## üöÄ **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥ (3 –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–≥–∞)**

### **–®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
```bash
# –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
scp /tmp/tunnel-system-20250901-110343.tar.gz root@your-server:/tmp/
```

### **–®–∞–≥ 2: –†–∞—Å–ø–∞–∫–æ–≤–∫–∞**  
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@your-server

# –†–∞—Å–ø–∞–∫—É–π—Ç–µ
cd /tmp
tar -xzf tunnel-system-20250901-110343.tar.gz
cd tunnel-system-20250901-110343
```

### **–®–∞–≥ 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞**
```bash
# –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ - –ø–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞!
sudo ./deploy.sh
```

**‚è±Ô∏è –í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏: 2-3 –º–∏–Ω—É—Ç—ã**

## ‚úÖ **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ—É—Å—Ç–∞–Ω–æ–≤—â–∏–∫**

1. **üîç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –û–°** (Ubuntu/Debian/CentOS/RHEL)
2. **üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (Python, Nginx, Supervisor)  
3. **üë§ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** tunnel-system (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
4. **üìÅ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π** `/opt/tunnel-system/`
5. **üêç Python venv** —Å –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
6. **‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**
7. **üîß Watchdog wrapper** —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
8. **üéõÔ∏è Systemd —Å–µ—Ä–≤–∏—Å** —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º
9. **üåê Nginx reverse proxy**
10. **üõ°Ô∏è Firewall** (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã)
11. **üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤**
12. **üìã –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

## üéõÔ∏è **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏**

```bash
# üöÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º
tunnel-system start      # –ó–∞–ø—É—Å–∫
tunnel-system stop       # –û—Å—Ç–∞–Ω–æ–≤–∫–∞  
tunnel-system restart    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
tunnel-system status     # –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
tunnel-system logs       # –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tunnel-system health     # –ü—Ä–æ–≤–µ—Ä–∫–∞ API

# üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
sudo systemctl status tunnel-broker  # –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
sudo journalctl -u tunnel-broker -f  # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
tail -f /var/log/tunnel-system/tunnel-broker.log  # –§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏
```

## üåç **–î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ**

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å–∞–º:

- **üåê Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** `http://your-server-ip`
- **üîß API –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø:** `http://your-server-ip:8080`  
- **üì° WebSocket:** `ws://your-server-ip:8081`
- **üíö Health check:** `http://your-server-ip:8080/health`

## üõ°Ô∏è **Watchdog –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫–∞–∂–¥—ã–µ **30 —Å–µ–∫—É–Ω–¥**
- ‚úÖ HTTP health check –Ω–∞ `/health` endpoint
- ‚úÖ –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ª—é–±—ã—Ö —Å–±–æ—è—Ö
- ‚úÖ **Graceful shutdown** (SIGTERM ‚Üí SIGKILL)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ **10 –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤/—á–∞—Å**
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

### **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ—è—Ö:**
1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã** ‚Üí –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥
2. **Graceful stop** (10 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ) 
3. **Force kill** –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–∏—Å
4. **–ü–∞—É–∑–∞ 5 —Å–µ–∫—É–Ω–¥**
5. **–ù–æ–≤—ã–π –∑–∞–ø—É—Å–∫** ‚Üí —Å—á–µ—Ç—á–∏–∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤
6. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞** –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤

## üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏**

```
/opt/tunnel-system/              # üè† –ì–ª–∞–≤–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
‚îú‚îÄ‚îÄ tunnel_broker.py             # üåê –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ tunnel_broker_service.py     # üîß Watchdog wrapper
‚îú‚îÄ‚îÄ farm_client.py               # üè≠ –ö–ª–∏–µ–Ω—Ç —Ñ–µ—Ä–º—ã
‚îú‚îÄ‚îÄ mobile_app.py                # üì± –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ  
‚îú‚îÄ‚îÄ config.ini                   # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ venv/                        # üêç Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ data/tunnel_broker.db        # üíæ SQLite –±–∞–∑–∞
‚îî‚îÄ‚îÄ manage.sh                    # üéõÔ∏è –°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

/var/log/tunnel-system/          # üìã –õ–æ–≥–∏
‚îî‚îÄ‚îÄ tunnel-broker.log            # üìÑ –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥

/etc/systemd/system/             # üéõÔ∏è Systemd
‚îî‚îÄ‚îÄ tunnel-broker.service        # üîß –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫

/etc/nginx/sites-available/      # üåê Nginx  
‚îî‚îÄ‚îÄ tunnel-system                # üîÑ Reverse proxy
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã**

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

```bash
# API –∑–¥–æ—Ä–æ–≤—å–µ
curl http://localhost:8080/health

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST http://localhost:8080/api/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","email":"test@test.com","password":"test123"}'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
tunnel-system status

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
tunnel-system logs
```

## üéØ **Production –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**

### **‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `tunnel-system`
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ firewall
- –ù–µ—Ç shell –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è service –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### **‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- Nginx reverse proxy –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
- Keep-alive —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è  
- –°–∂–∞—Ç–∏–µ gzip
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### **‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- Health check endpoints
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
- –°–∏—Å—Ç–µ–º–Ω—ã–π –∂—É—Ä–Ω–∞–ª journalctl
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤

### **‚úÖ Maintenance:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
- Graceful restart –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

## üìû **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**

### **–ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º:**
```bash
# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
sudo systemctl status tunnel-broker
sudo journalctl -u tunnel-broker -n 50
tunnel-system health
```

### **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—Ç–∞–º–∏:**
```bash
sudo ss -tlnp | grep -E ":80|:8080|:8081"
sudo ufw status
```

### **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é:**
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
htop
df -h
```

## üéâ **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

**‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –¥–ª—è production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**

- **üèÅ –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞** —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- **üîß –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** –Ω–∞—Å—Ç—Ä–æ–π–∫–∏  
- **üõ°Ô∏è –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** —Å watchdog
- **üìä –ü–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **üöÄ Instant deployment** –∑–∞ 2-3 –º–∏–Ω—É—Ç—ã

---

### üéØ **–ò—Ç–æ–≥–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
scp /tmp/tunnel-system-20250901-110343.tar.gz root@your-server:/tmp/

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ  
ssh root@your-server
cd /tmp && tar -xzf tunnel-system-20250901-110343.tar.gz
cd tunnel-system-20250901-110343
sudo ./deploy.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞
tunnel-system status
curl http://your-server-ip:8080/health
```

**üåü –í—Å—ë –≥–æ—Ç–æ–≤–æ! –°–∏—Å—Ç–µ–º–∞ IXON-—Ç–∏–ø–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!**