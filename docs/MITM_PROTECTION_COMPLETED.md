# üîí –ó–ê–©–ò–¢–ê –û–¢ MITM –ê–¢–ê–ö –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê

## ‚úÖ **–°–¢–ê–¢–£–°: –ü–û–õ–ù–ê–Ø –ó–ê–©–ò–¢–ê –û–¢ "–ß–ï–õ–û–í–ï–ö –ü–û–°–ï–†–ï–î–ò–ù–ï"**

–°–∏—Å—Ç–µ–º–∞ CUBE_RS —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –º–Ω–æ–≥—É—Ä–æ–≤–Ω–µ–≤—É—é –∑–∞—â–∏—Ç—É –æ—Ç MITM (Man-in-the-Middle) –∞—Ç–∞–∫.

---

## üõ°Ô∏è **–†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –£–†–û–í–ù–ò –ó–ê–©–ò–¢–´**

### 1. **Certificate Pinning** - –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
**–§–∞–π–ª:** `security/mitm_protection.py`

‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- **Public Key Pinning** - –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **Certificate Pinning** - –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ pin –∏–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–º–µ–Ω—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ JSON —Ñ–∞–π–ª

### 2. **Mutual TLS (mTLS)** - –í–∑–∞–∏–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
**–§–∞–π–ª:** `security/mutual_tls.py`

‚úÖ **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –¶–µ–Ω—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (CA) –¥–ª—è –≤—ã–ø—É—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–æ–º
- –ü—Ä–∏–≤—è–∑–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º

### 3. **–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏**
**–§–∞–π–ª:** `tools/certificate_manager_cli.py`

‚úÖ **CLI –∫–æ–º–∞–Ω–¥—ã:**
- `init-ca` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `create-client` - –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- `list-certs` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ä–æ–∫–∞—Ö
- `revoke-cert` - –û—Ç–∑—ã–≤ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- `pin-cert` - –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤
- `verify-pin` - –ü—Ä–æ–≤–µ—Ä–∫–∞ certificate pin
- `ca-info` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ CA

### 4. **–°–µ—Ç–µ–≤–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
**–§–∞–π–ª:** `monitoring/network_security_monitor.py`

‚úÖ **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞—Ç–∞–∫:**
- DNS —Å–ø—É—Ñ–∏–Ω–≥ –∏ –æ—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ
- –°–º–µ–Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –†–µ–∑–æ–ª—é—Ü–∏—è –ø—É–±–ª–∏—á–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ IP
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- –ê–Ω–∞–ª–∏–∑ TLS handshake

### 5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**

Auto Registration Client —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞—â–∏—â–µ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç:
- Certificate pinning –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ MITM –∞—Ç–∞–∫
- Fallback –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –∫–ª–∏–µ–Ω—Ç—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üîß **–ù–ê–°–¢–†–û–ô–ö–ê –ó–ê–©–ò–¢–´**

### **–®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CA**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
python tools/certificate_manager_cli.py init-ca \
  --ca-name "CUBE_RS_Production_CA" \
  --organization "Your Company" \
  --country "RU"
```

### **–®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤**
```bash
# –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
python tools/certificate_manager_cli.py create-client \
  --device-id gateway-001 \
  --common-name "CUBE Gateway 001" \
  --dns-names "gateway-001.local,gateway-001.company.com" \
  --save
```

### **–®–∞–≥ 3: –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤**
```bash
# –ó–∞–∫—Ä–µ–ø–ª—è–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞
python tools/certificate_manager_cli.py pin-cert \
  --hostname api.company.com \
  --description "Production API server"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º pin
python tools/certificate_manager_cli.py verify-pin \
  --hostname api.company.com
```

### **–®–∞–≥ 4: –ó–∞–ø—É—Å–∫ —Å–µ—Ç–µ–≤–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
python monitoring/network_security_monitor.py --daemon --interface eth0
```

---

## üö® **–û–ë–ù–ê–†–£–ñ–ï–ù–ò–ï MITM –ê–¢–ê–ö**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

1. **Certificate Pinning Failure**
   - –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–º—É
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç "critical"

2. **Certificate Change Detection**
   - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å–º–µ–Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–ª–µ—Ä—Ç—ã

3. **DNS Spoofing**
   - –û–¥–∏–Ω –¥–æ–º–µ–Ω —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã–µ IP
   - –ü—É–±–ª–∏—á–Ω—ã–µ –¥–æ–º–µ–Ω—ã –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ IP

4. **TLS Handshake Anomalies**
   - –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã TLS

### **–ü—Ä–∏–º–µ—Ä—ã –∞–ª–µ—Ä—Ç–æ–≤:**
```
üö® [CRITICAL] certificate_pin_mismatch: Certificate pin for api.company.com does not match
‚ö†Ô∏è  [HIGH] certificate_change: Certificate change detected for api.company.com  
üîç [MEDIUM] dns_anomaly: DNS spoofing suspected for domain api.company.com
```

---

## üîê **SECURITY BEST PRACTICES**

### **Certificate Pinning:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Public Key Pinning** –≤–º–µ—Å—Ç–æ Certificate Pinning
- Pinning –∫ intermediate CA, –∞ –Ω–µ –∫ leaf certificate
- –ò–º–µ–π—Ç–µ backup pins –¥–ª—è rotation —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

### **Mutual TLS:**
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å –∫–æ—Ä–æ—Ç–∫–∏–º —Å—Ä–æ–∫–æ–º –∂–∏–∑–Ω–∏ (1 –≥–æ–¥)
- –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –û—Ç–∑—ã–≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- 24/7 –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏  
- –ê–ª–µ—Ä—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π

---

## üìä **–ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ê–õ–ï–†–¢–´**

### **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—â–∏—Ç—ã:**
```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ certificate pinning
python tools/certificate_manager_cli.py list-pins

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
python monitoring/network_security_monitor.py --stats

# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
python monitoring/security_monitor.py --stats
```

### **–¢–∏–ø—ã –∞–ª–µ—Ä—Ç–æ–≤:**
- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ MITM –∞—Ç–∞–∫–∞—Ö
- Telegram —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SIEM —Å–∏—Å—Ç–µ–º–∞–º–∏
- Slack —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢**

### ‚úÖ **–ü–û–õ–ù–ê–Ø –ó–ê–©–ò–¢–ê –û–¢ MITM:**

1. **Certificate Pinning** - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ ‚úÖ
2. **Mutual TLS** - –í–∑–∞–∏–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞ ‚úÖ
3. **DNS Monitoring** - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ DNS —Å–ø—É—Ñ–∏–Ω–≥–∞ ‚úÖ
4. **Network Analysis** - –ê–Ω–∞–ª–∏–∑ —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ ‚úÖ
5. **Certificate Management** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ ‚úÖ
6. **Real-time Alerts** - –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∞—Ç–∞–∫–∞—Ö ‚úÖ
7. **Automatic Detection** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É–≥—Ä–æ–∑ ‚úÖ
8. **Fallback Security** - –†–µ–∑–µ—Ä–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã ‚úÖ

### üõ°Ô∏è **–ó–ê–©–ò–©–ï–ù–û:**
- ‚úÖ Gateway ‚Üí Server –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
- ‚úÖ Device Registration –ø—Ä–æ—Ü–µ—Å—Å  
- ‚úÖ Production workflows
- ‚úÖ Certificate management
- ‚úÖ Network communications
- ‚úÖ DNS —Ä–µ–∑–æ–ª—é—Ü–∏—è

### üö® **–û–ë–ù–ê–†–£–ñ–ò–í–ê–ï–¢–°–Ø:**
- ‚úÖ –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- ‚úÖ DNS –æ—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ –°–µ—Ç–µ–≤—ã–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–∏
- ‚úÖ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ –ê–Ω–æ–º–∞–ª–∏–∏ TLS handshake
- ‚úÖ –°–º–µ–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç enterprise-—É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã –æ—Ç MITM –∞—Ç–∞–∫! üîí**