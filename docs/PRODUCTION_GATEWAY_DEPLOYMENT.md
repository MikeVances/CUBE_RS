# üè≠ –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–û–ï –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï GATEWAY –®–õ–Æ–ó–û–í

## üéØ **–í–ê–® –°–¶–ï–ù–ê–†–ò–ô - –ü–†–ê–í–ò–õ–¨–ù–´–ô –ò –ë–ï–ó–û–ü–ê–°–ù–´–ô!**

### ‚úÖ **–¢–µ–∫—É—â–∏–π –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π workflow:**
1. **–ù–∞ –∑–∞–≤–æ–¥–µ**: Gateway –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–ª—é—á
2. **–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ**: –ü–µ—Ä—Å–æ–Ω–∞–ª —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
3. **–í —Å–∏—Å—Ç–µ–º–µ**: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Gateway –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

---

## üîí **–ê–ù–ê–õ–ò–ó –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –í–ê–®–ï–ì–û –ü–û–î–•–û–î–ê**

### ‚úÖ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:**
- **üõ°Ô∏è –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –¥–æ—Å—Ç—É–ø** - —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- **üîê Pre-shared keys** - –∫–ª—é—á–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã –∑–∞—Ä–∞–Ω–µ–µ
- **üë• –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å** - –ø–µ—Ä—Å–æ–Ω–∞–ª —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- **üìã Audit trail** - –≤—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- **üö´ Zero Trust** - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω

### ‚ö†Ô∏è **–ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –†–ò–°–ö–ò:**
- **üîë –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –∫–ª—é—á–∞** - –µ—Å–ª–∏ –∫–ª—é—á —É—Ç–µ–∫–∞–µ—Ç
- **üë§ Human error** - –æ—à–∏–±–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **üì¶ Supply chain** - –∫–ª—é—á–∏ –≤ –ø—Ä–æ—à–∏–≤–∫–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∏–¥–Ω—ã

---

## üí° **–£–õ–£–ß–®–ï–ù–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò:**

### ü•á **–°–¶–ï–ù–ê–†–ò–ô 1: FACTORY PRE-PROVISIONING (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)**

#### **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**
```bash
# –ù–∞ –∑–∞–≤–æ–¥–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):
1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π Device ID
2. –°–æ–∑–¥–∞–µ—Ç—Å—è pre-shared key –¥–ª—è —ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞  
3. –ö–ª—é—á –∑–∞—à–∏–≤–∞–µ—Ç—Å—è –≤ –∑–∞—â–∏—â–µ–Ω–Ω—É—é –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏
4. Device ID + Key Hash –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ production database
```

#### **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø–æ–ª–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CLI:
python tools/provision_gateway.py \
  --device-id GW-2024-001-XYZ \
  --location "–¢–µ–ø–ª–∏—Ü–∞ –ê–≥—Ä–æ—Ñ–∏—Ä–º—ã –ò–≤–∞–Ω–æ–≤" \
  --installer "–¢–µ—Ö–Ω–∏–∫ –ü–µ—Ç—Ä–æ–≤" \
  --verify-hardware-signature

# –†–µ–∑—É–ª—å—Ç–∞—Ç: Gateway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
```

#### **–ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```python
# tools/provision_gateway.py
def provision_gateway(device_id: str, location: str, installer: str):
    registry = get_device_registry()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ pre-registered
    device_info = registry.get_preregistered_device(device_id)
    if not device_info:
        raise SecurityError(f"Device {device_id} not found in production database")
    
    # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
    registry.activate_preregistered_device(
        device_id=device_id,
        location=location,
        activated_by=installer,
        activation_time=datetime.now()
    )
    
    print(f"‚úÖ Gateway {device_id} activated and ready for deployment")
```

### ü•à **–°–¶–ï–ù–ê–†–ò–ô 2: SECURE BOOTSTRAP (–û—á–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π)**

#### **–ü—Ä–∏–Ω—Ü–∏–ø:**
```
Gateway ‚îÄ‚îÄ‚ñ∫ Certificate Request ‚îÄ‚îÄ‚ñ∫ Manual Approval ‚îÄ‚îÄ‚ñ∫ Signed Certificate ‚îÄ‚îÄ‚ñ∫ Access
```

#### **–ü—Ä–æ—Ü–µ—Å—Å:**
```bash
# 1. Gateway –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç CSR (Certificate Signing Request)
openssl req -new -key gateway.key -out gateway.csr

# 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç CSR + Hardware Signature –Ω–∞ —Å–µ—Ä–≤–µ—Ä
curl -X POST /api/bootstrap/request \
  -d '{"csr": "...", "hardware_id": "MAC:XX:XX:XX", "location": "..."}'

# 3. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ–¥–æ–±—Ä—è–µ—Ç
python tools/admin_cli.py approve-certificate --csr-id ABC123

# 4. Gateway –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
curl /api/bootstrap/certificate/ABC123 > gateway.crt
```

### ü•â **–°–¶–ï–ù–ê–†–ò–ô 3: ONE-TIME ACTIVATION CODE (–ü—Ä–æ—Å—Ç–æ–π)**

#### **–ü—Ä–æ—Ü–µ—Å—Å:**
```bash
# 1. –ù–∞ –∑–∞–≤–æ–¥–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è QR-–∫–æ–¥ —Å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–º –∫–æ–¥–æ–º
QR: CUBE-ACTIVATE:GW240901:7A8B9C2D

# 2. –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR –∏ –≤–≤–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É  
python tools/activate_gateway.py --qr-code "CUBE-ACTIVATE:GW240901:7A8B9C2D"

# 3. Gateway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ
```

---

## üõ†Ô∏è **–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –í–ê–®–ï–ì–û –°–¶–ï–ù–ê–†–ò–Ø**

### **–®–∞–≥ 1: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è Device Registry**

```python
# –î–æ–±–∞–≤–ª—è–µ–º –≤ web_app/device_registry.py:

class ProductionDeviceRegistry(DeviceRegistry):
    """–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã"""
    
    def create_production_batch(self, 
                               batch_id: str,
                               device_count: int,
                               device_type: str = "gateway",
                               expires_days: int = 365) -> List[Dict[str, str]]:
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞"""
        devices = []
        
        for i in range(device_count):
            device_id = f"{batch_id}-{i+1:03d}"
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º pre-shared key
            auth_key = self.generate_auth_key(
                expires_hours=expires_days * 24,
                max_usage=1,  # –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª—é—á
                is_reusable=False,
                tags=["production", "gateway", batch_id],
                created_by="factory"
            )
            
            devices.append({
                "device_id": device_id,
                "auth_key": auth_key,
                "batch_id": batch_id,
                "production_date": datetime.now().isoformat(),
                "status": "manufactured"
            })
            
        return devices
    
    def provision_gateway_by_installer(self,
                                     device_id: str,
                                     installer_name: str,
                                     location: str,
                                     customer_info: Dict[str, Any]) -> bool:
        """–ê–∫—Ç–∏–≤–∞—Ü–∏—è Gateway —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–æ–º –≤ –ø–æ–ª–µ"""
        try:
            # –ù–∞—Ö–æ–¥–∏–º pre-manufactured —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
            device = self.get_premanufactured_device(device_id)
            if not device:
                raise ValueError(f"Device {device_id} not found in production registry")
            
            # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
            activation_request = {
                "device_id": device_id,
                "installer": installer_name,
                "location": location,
                "customer": customer_info,
                "activation_time": datetime.now().isoformat(),
                "status": "field_activated"
            }
            
            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è–µ–º –µ—Å–ª–∏ –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
            return self.auto_approve_production_device(device_id, activation_request)
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ {device_id}: {e}")
            return False
```

### **–®–∞–≥ 2: CLI –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞**

```python
# tools/production_cli.py

def create_production_batch(args):
    """–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞"""
    registry = ProductionDeviceRegistry()
    
    devices = registry.create_production_batch(
        batch_id=args.batch_id,
        device_count=args.count,
        device_type="gateway",
        expires_days=365
    )
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ CSV –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
    with open(f"production_batch_{args.batch_id}.csv", 'w') as f:
        f.write("device_id,auth_key,qr_code\n")
        for device in devices:
            qr_data = f"CUBE-GW:{device['device_id']}:{device['auth_key'][:16]}"
            f.write(f"{device['device_id']},{device['auth_key']},{qr_data}\n")
    
    print(f"‚úÖ –°–æ–∑–¥–∞–Ω–æ {len(devices)} —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —Å–µ—Ä–∏–∏ {args.batch_id}")
    print(f"üìÅ –§–∞–π–ª: production_batch_{args.batch_id}.csv")

def field_activation(args):
    """–ê–∫—Ç–∏–≤–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–æ–º"""
    registry = ProductionDeviceRegistry()
    
    success = registry.provision_gateway_by_installer(
        device_id=args.device_id,
        installer_name=args.installer,
        location=args.location,
        customer_info={
            "company": args.customer_company,
            "contact": args.customer_contact,
            "phone": args.customer_phone
        }
    )
    
    if success:
        print(f"‚úÖ Gateway {args.device_id} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–∏—Å—Ç–µ–º–µ")
        print(f"üåê –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ mesh-—Å–µ—Ç–∏")
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Gateway {args.device_id}")
```

### **–®–∞–≥ 3: Gateway client –∫–æ–¥**

```python
# gateway/client/auto_registration.py

class GatewayAutoRegistration:
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Gateway –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ"""
    
    def __init__(self):
        self.device_id = self.get_hardware_device_id()
        self.auth_key = self.load_preinstalled_key()
    
    def get_hardware_device_id(self) -> str:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –∏–∑ –∂–µ–ª–µ–∑–∞"""
        # MAC –∞–¥—Ä–µ—Å + Serial –Ω–æ–º–µ—Ä + Hardware ID
        import uuid
        mac = uuid.getnode()
        return f"GW-{mac:012x}".upper()
    
    def load_preinstalled_key(self) -> str:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞"""
        # –ò–∑ –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ TPM
        key_file = "/etc/cube-gateway/auth.key"
        try:
            with open(key_file, 'r') as f:
                return f.read().strip()
        except FileNotFoundError:
            raise RuntimeError("Auth key not found. Device not provisioned.")
    
    def register_with_server(self, server_url: str) -> bool:
        """–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"""
        try:
            registry_client = DeviceRegistryClient(server_url)
            
            success = registry_client.register_device(
                device_id=self.device_id,
                auth_key=self.auth_key,
                device_type="gateway",
                device_info={
                    "hardware_id": self.device_id,
                    "software_version": get_version(),
                    "capabilities": ["modbus_tcp", "kub1063", "data_collection"],
                    "registration_method": "auto_production"
                }
            )
            
            if success:
                logger.info(f"Gateway {self.device_id} registered successfully")
                return True
            else:
                logger.error(f"Registration failed for {self.device_id}")
                return False
                
        except Exception as e:
            logger.error(f"Registration error: {e}")
            return False
```

---

## üè≠ **–ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–´–ô WORKFLOW**

### **–ù–ê –ó–ê–í–û–î–ï (Production Team):**

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
```bash
# –°–æ–∑–¥–∞–µ–º –ø–∞—Ä—Ç–∏—é –∏–∑ 100 Gateway
python tools/production_cli.py create-batch \
  --batch-id "2024-Q3-001" \
  --count 100 \
  --type gateway

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - 100 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö Device ID
# - 100 pre-shared –∫–ª—é—á–µ–π
# - CSV —Ñ–∞–π–ª —Å QR-–∫–æ–¥–∞–º–∏
```

#### 2. –ü—Ä–æ—à–∏–≤–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
```bash
# –î–ª—è –∫–∞–∂–¥–æ–≥–æ Gateway:
# 1. –ó–∞–ø–∏—Å–∞—Ç—å Device ID –≤ EEPROM
# 2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å Auth Key –≤ /etc/cube-gateway/auth.key
# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
# 4. –ù–∞–∫–ª–µ–∏—Ç—å QR-–∫–æ–¥ —Å Device ID
```

### **–í –ü–û–õ–ï (–£—Å—Ç–∞–Ω–æ–≤—â–∏–∫):**

#### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
```bash
# Gateway –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É (WiFi/Ethernet)
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```

#### 2. –ê–∫—Ç–∏–≤–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–æ–º
```bash
# –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR-–∫–æ–¥ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç
python tools/production_cli.py field-activate \
  --device-id "GW-2024-Q3-001-042" \
  --installer "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤" \
  --location "–¢–µ–ø–ª–∏—Ü–∞ –ê–≥—Ä–æ—Ñ–∏—Ä–º—ã –°–∏–¥–æ—Ä–æ–≤" \
  --customer-company "–û–û–û –ê–≥—Ä–æ—Å–∏–¥–æ—Ä–æ–≤" \
  --customer-contact "–°–∏–¥–æ—Ä–æ–≤ –ê.–ò." \
  --customer-phone "+7-999-123-4567"

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ Gateway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–∏—Å—Ç–µ–º–µ
# üåê –î–æ—Å—Ç—É–ø–µ–Ω –≤ Tailscale mesh-—Å–µ—Ç–∏
# üì± –í–∏–¥–µ–Ω –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```

### **–í –¶–ï–ù–¢–†–ï –£–ü–†–ê–í–õ–ï–ù–ò–Ø (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä):**

#### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–æ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
python tools/admin_cli.py list-devices --status active

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–∂–∏–¥–∞—é—â–∏—Ö –æ–¥–æ–±—Ä–µ–Ω–∏—è (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
python tools/admin_cli.py list-pending
```

#### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
python tools/admin_cli.py create-user \
  --username "sidorov_farm" \
  --email "sidorov@agro.com" \
  --full-name "–°–∏–¥–æ—Ä–æ–≤ –ê.–ò." \
  --password "farm2024!" \
  --role "Farm Operator"

# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É Gateway
# (—á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ API)
```

---

## üîí **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò BEST PRACTICES**

### ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

1. **üîê Secure Key Storage**
   ```bash
   # Auth –∫–ª—é—á–∏ –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏:
   chmod 600 /etc/cube-gateway/auth.key
   chown gateway:gateway /etc/cube-gateway/auth.key
   ```

2. **üì± Hardware Binding**
   ```python
   # –ü—Ä–∏–≤—è–∑–∫–∞ –∫ MAC –∞–¥—Ä–µ—Å—É –∏ Serial –Ω–æ–º–µ—Ä—É
   device_fingerprint = f"{mac_address}:{cpu_serial}:{board_id}"
   ```

3. **‚è∞ Key Expiration**
   ```bash
   # Pre-shared –∫–ª—é—á–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
   # –ù–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ—Ç–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ 1 –≥–æ–¥
   ```

4. **üîç Audit Logging**
   ```python
   # –í—Å–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
   logger.info(f"Device {device_id} activated by {installer} at {location}")
   ```

5. **üö® Security Alerts**
   ```python
   # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:
   # - –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞
   # - –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∏–∑ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏
   # - –ò–∑–º–µ–Ω–µ–Ω–∏–µ hardware fingerprint
   ```

### ‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏:**

1. **Key Extraction** - –∫–ª—é—á–∏ –≤ —Ñ–∞–π–ª–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω—ã
   - *–†–µ—à–µ–Ω–∏–µ*: Hardware Security Module (HSM) –∏–ª–∏ TPM

2. **Supply Chain** - –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –Ω–∞ —ç—Ç–∞–ø–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
   - *–†–µ—à–µ–Ω–∏–µ*: –ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã + attestation

3. **Insider Threat** - –Ω–µ–¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∏
   - *–†–µ—à–µ–Ω–∏–µ*: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + –¥–≤–æ–π–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

---

## üéØ **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò**

### ‚úÖ **–í–ê–® –°–¶–ï–ù–ê–†–ò–ô –û–ü–¢–ò–ú–ê–õ–¨–ù–´–ô!**

**–°—Ö–µ–º–∞ "Pre-shared key + Field activation" - —ç—Ç–æ:**
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ** - —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ** - –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ** - —á–µ–ª–æ–≤–µ–∫ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚úÖ **–ê—É–¥–∏—Ä—É–µ–º–æ** - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

### üöÄ **–í–û–ó–ú–û–ñ–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø:**

1. **Hardware Security Module**
   - –ö–ª—é—á–∏ –≤ TPM —á–∏–ø–µ
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

2. **Certificate-based Authentication**
   - –í–º–µ—Å—Ç–æ pre-shared –∫–ª—é—á–µ–π
   - PKI –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

3. **Zero-Touch Provisioning**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
   - –ú–∏–Ω–∏–º—É–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

### üìã **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:**

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ProductionDeviceRegistry** - —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–∏—Å—Ç–µ–º—É
2. **–°–æ–∑–¥–∞—Ç—å Production CLI** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–≤–æ–¥–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–æ–≤  
3. **–î–æ–±–∞–≤–∏—Ç—å Hardware binding** - –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∂–µ–ª–µ–∑—É
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –∞–ª–µ—Ä—Ç—ã –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**–í–∞—à–∞ —Å—Ö–µ–º–∞ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è! üè≠‚úÖ**
```

<function_calls>
<invoke name="TodoWrite">
<parameter name="todos">[{"content": "\u0410\u043d\u0430\u043b\u0438\u0437 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432", "status": "completed", "activeForm": "\u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u044e \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0439 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438"}, {"content": "\u041f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0439 \u0441\u0445\u0435\u043c\u044b \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0448\u043b\u044e\u0437\u043e\u0432", "status": "in_progress", "activeForm": "\u041f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u0443\u044e \u0441\u0445\u0435\u043c\u0443 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438"}, {"content": "\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 improved workflow \u0434\u043b\u044f \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0440\u0430\u0437\u0432\u0435\u0440\u0442\u044b\u0432\u0430\u043d\u0438\u044f", "status": "pending", "activeForm": "\u0421\u043e\u0437\u0434\u0430\u044e \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u043d\u044b\u0439 workflow"}]